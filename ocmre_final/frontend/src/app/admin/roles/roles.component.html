<mat-card>
  <mat-card-header>
    <mat-card-title>
      <h4>
        <i class="bi bi-plus-circle-fill icon-margin"></i> Creación de Roles
      </h4><br>  
    </mat-card-title>
  </mat-card-header><br>  

  <form [formGroup]="rolForm" (ngSubmit)="crearRol()" class="form-container">
   <!-- Remove this block: -->
    
    <!--div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>ID Rol</mat-label>
        <input  matInput formControlName="idRol" placeholder="Ingrese el ID del rol"  maxlength="5"  (input)="onNumberInput($event)" hidden>
      </mat-form-field>
    </div-->
 

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nombre del Rol</mat-label>
        <input matInput formControlName="nombre" placeholder="Ingrese el nombre del rol"
               maxlength="200"
               (keyup)="toUpperCase('nombre')" (input)="onNombreInput()">
        <mat-error *ngIf="rolForm.get('nombre')?.hasError('required')">
          El nombre del rol es obligatorio.
        </mat-error>
        <mat-error *ngIf="rolForm.get('nombre')?.hasError('pattern')">
          Solo se permiten letras, espacios y guiones bajos.
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descripción</mat-label>
        <textarea matInput formControlName="descripcion"
                  placeholder="Breve descripción del rol"
                  maxlength="500"
                  (keyup)="toUpperCase('descripcion')" (input)="onDescripcionInput()">
        </textarea>
        <mat-error *ngIf="rolForm.get('descripcion')?.hasError('required')">
          La descripción es obligatoria.
        </mat-error>
        <mat-error *ngIf="rolForm.get('descripcion')?.hasError('pattern')">
          Solo se permiten letras y espacios.
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-actions">
      <button mat-flat-button color="primary" type="submit" [disabled]="rolForm.invalid">
        <mat-icon>add</mat-icon> Crear Rol
      </button>
    </div>
  </form>


  <!-- Sección de Roles -->
<mat-card class="custom-card">
  
  <mat-card-header>
    <mat-card-title>
  <h4><i class="bi bi-card-list  icon-margin"></i>Lista de Roles</h4><br>  
    </mat-card-title>
  </mat-card-header><br>  


  <div class="table-container">

    <mat-form-field appearance="outline" style="width: 100%;">
      <mat-label>Buscar</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Buscar rol...">
    </mat-form-field>

    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>

      <!-- ID -->
      <ng-container matColumnDef="idRol">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
        <td mat-cell *matCellDef="let rol"> {{ rol.idRol }} </td>
      </ng-container>
    
      <!-- Nombre -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre </th>
        <td mat-cell *matCellDef="let rol"> {{ rol.nombre }} </td>
      </ng-container>
    
      <!-- Descripción -->
      <ng-container matColumnDef="descripcion">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Descripción </th>
        <td mat-cell *matCellDef="let rol"> {{ rol.descripcion }} </td>
      </ng-container>
    
      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let rol">
          <button mat-icon-button color="primary" (click)="editarRol(rol)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="eliminarRol(rol)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
    
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <mat-paginator #paginatorRoles
               [pageSizeOptions]="[5, 10, 20]"
               showFirstLastButtons>
    </mat-paginator>

  </div>
</mat-card>

<!-- Sección de Asignar Roles -->
<mat-card class="custom-card">
  
  <mat-card-header>
    <mat-card-title>
  <h4><i class="bi bi-person-rolodex  icon-margin"></i> Asignar Roles a Usuarios</h4><br>  
    </mat-card-title>
  </mat-card-header><br>  

  <form [formGroup]="asignacionForm" (ngSubmit)="asignarRol()" class="assign-form">
    <mat-form-field appearance="outline">
      <mat-label>Usuario</mat-label>
      <input matInput formControlName="usuarioUsu" placeholder="Ingrese el usuario">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>ID Rol</mat-label>
      <input matInput formControlName="idRol" placeholder="Ingrese el ID del rol">
    </mat-form-field>

    <button mat-raised-button color="primary" type="submit" [disabled]="asignacionForm.invalid">
      Asignar Rol
    </button>
  </form>

  <!-- Tabla de Asignaciones -->
 
  <div class="table-container">

    <mat-form-field appearance="outline" style="width: 100%;">
      <mat-label>Buscar usuario o rol</mat-label>
      <input matInput (keyup)="applyFilterAsignaciones($event)" placeholder="Buscar...">
    </mat-form-field>
  
      <table mat-table [dataSource]="dataSourceAsignaciones" matSort class="mat-elevation-z8" *ngIf="asignaciones.length > 0">

      <!-- Usuario -->
      <ng-container matColumnDef="usuarioUsu">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Usuario </th>
        <td mat-cell *matCellDef="let asignacion"> {{ asignacion.usuarioUsu }} </td>
      </ng-container>
  
      <!-- ID Rol -->
      <ng-container matColumnDef="idRol">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> ID Rol </th>
        <td mat-cell *matCellDef="let asignacion"> {{ asignacion.idRol }} </td>
      </ng-container>
  
      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let asignacion">
          <button mat-icon-button color="warn" (click)="eliminarAsignacion(asignacion.usuarioUsu, asignacion.idRol)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>
  
      <tr mat-header-row *matHeaderRowDef="displayedColumnsAsignaciones"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsAsignaciones;"></tr>
    </table>
  
    <mat-paginator #paginatorAsignaciones
               [pageSizeOptions]="[5, 10, 20]"
               showFirstLastButtons>
    </mat-paginator>

  
  </div>

  <p *ngIf="asignaciones.length === 0" class="empty-message">No hay asignaciones registradas.</p>
</mat-card>
