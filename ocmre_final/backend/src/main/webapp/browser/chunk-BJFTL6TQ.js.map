{
  "version": 3,
  "sources": ["src/app/services/auth.service.ts"],
  "sourcesContent": ["// src/app/services/auth.service.ts\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, tap } from 'rxjs';\r\nimport { Router } from '@angular/router';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  private apiUrl = '/api/auth';\r\n\r\n  constructor(private http: HttpClient, private router: Router) {}\r\n\r\n  // âœ… Login con almacenamiento de token y redirecciÃ³n por rol\r\n  login(credentials: { usuarioUsu: string; passwordUsu: string }): Observable<any> {\r\n    return this.http.post(`${this.apiUrl}/login`, credentials).pipe(\r\n      tap((res: any) => {\r\n        if (res.token) {\r\n          localStorage.setItem('token', res.token);\r\n\r\n          // const roles = this.getRoles();\r\n          this.router.navigate(['/dashboard/ficha']);\r\n\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  // âœ… Obtiene el token almacenado\r\n  getToken(): string | null {\r\n    return localStorage.getItem('token');\r\n  }\r\n\r\n  // âœ… Verifica si el usuario estÃ¡ logueado\r\n  // isLoggedIn(): boolean {\r\n  //   return !!this.getToken();\r\n  // }\r\n\r\n\r\n  isLoggedIn(): boolean {\r\n    const token = this.getToken();\r\n    if (!token) return false;\r\n  \r\n    try {\r\n      const payload = JSON.parse(atob(token.split('.')[1]));\r\n      const isTokenExpired = payload.exp * 1000 < Date.now(); // Verifica si el token ha expirado\r\n      return !isTokenExpired; // Retorna true si el token no ha expirado\r\n    } catch (e) {\r\n      console.error('Error parsing token payload:', e);\r\n      return false; // Si el token es invÃ¡lido, retorna false\r\n    }\r\n  }\r\n  \r\n  // âœ… Extrae los roles desde el payload del JWT\r\n  getRoles(): string[] {\r\n    const token = this.getToken();\r\n    if (!token) return [];\r\n    try {\r\n      const payload = JSON.parse(atob(token.split('.')[1]));\r\n      const rawRoles = payload.roles || [];\r\n\r\n      if (rawRoles.length === 0) {\r\n        // ðŸš€ Si no tiene roles, lo tratamos como COMISIONADO por defecto\r\n        return ['COMISIONADO'];\r\n      }\r\n \r\n\r\n      // Quita el prefijo \"ROLE_\" si lo tiene\r\n      const cleanedRoles = rawRoles.map((role: string) =>\r\n        role.startsWith('ROLE_') ? role.substring(5) : role\r\n      );\r\n\r\n    return cleanedRoles;\r\n    \r\n    } catch (e) {\r\n      console.error('Error parsing token payload:', e);\r\n      return [];\r\n    }\r\n  }\r\n  \r\n  \r\n\r\n  // âœ… FunciÃ³n para redireccionar segÃºn los roles\r\n  private redirectByRole(roles: string[]): void {\r\n    if (roles.some(role => role.includes('COMISIONADO'))) {\r\n      this.router.navigate(['/admin']);\r\n    } else if (roles.some(role => role.includes('ESPECIALISTA'))) {\r\n      this.router.navigate(['/especialista']);\r\n    } else if (roles.some(role => role.includes('EXTERNO'))) {\r\n      this.router.navigate(['/externo']);\r\n    } else {\r\n      this.logout();\r\n    }\r\n  }\r\n  \r\n\r\n  // âœ… Logout con limpieza del token y redirecciÃ³n al login\r\n  logout(): void {\r\n    localStorage.removeItem('token');\r\n    this.router.navigate(['/']);\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;AASM,IAAO,cAAP,MAAO,aAAW;EAGF;EAA0B;EAFtC,SAAS;EAEjB,YAAoB,MAA0B,QAAc;AAAxC,SAAA,OAAA;AAA0B,SAAA,SAAA;EAAiB;;EAG/D,MAAM,aAAwD;AAC5D,WAAO,KAAK,KAAK,KAAK,GAAG,KAAK,MAAM,UAAU,WAAW,EAAE,KACzD,IAAI,CAAC,QAAY;AACf,UAAI,IAAI,OAAO;AACb,qBAAa,QAAQ,SAAS,IAAI,KAAK;AAGvC,aAAK,OAAO,SAAS,CAAC,kBAAkB,CAAC;MAE3C;IACF,CAAC,CAAC;EAEN;;EAGA,WAAQ;AACN,WAAO,aAAa,QAAQ,OAAO;EACrC;;;;;EAQA,aAAU;AACR,UAAM,QAAQ,KAAK,SAAQ;AAC3B,QAAI,CAAC;AAAO,aAAO;AAEnB,QAAI;AACF,YAAM,UAAU,KAAK,MAAM,KAAK,MAAM,MAAM,GAAG,EAAE,CAAC,CAAC,CAAC;AACpD,YAAM,iBAAiB,QAAQ,MAAM,MAAO,KAAK,IAAG;AACpD,aAAO,CAAC;IACV,SAAS,GAAG;AACV,cAAQ,MAAM,gCAAgC,CAAC;AAC/C,aAAO;IACT;EACF;;EAGA,WAAQ;AACN,UAAM,QAAQ,KAAK,SAAQ;AAC3B,QAAI,CAAC;AAAO,aAAO,CAAA;AACnB,QAAI;AACF,YAAM,UAAU,KAAK,MAAM,KAAK,MAAM,MAAM,GAAG,EAAE,CAAC,CAAC,CAAC;AACpD,YAAM,WAAW,QAAQ,SAAS,CAAA;AAElC,UAAI,SAAS,WAAW,GAAG;AAEzB,eAAO,CAAC,aAAa;MACvB;AAIA,YAAM,eAAe,SAAS,IAAI,CAAC,SACjC,KAAK,WAAW,OAAO,IAAI,KAAK,UAAU,CAAC,IAAI,IAAI;AAGvD,aAAO;IAEP,SAAS,GAAG;AACV,cAAQ,MAAM,gCAAgC,CAAC;AAC/C,aAAO,CAAA;IACT;EACF;;EAKQ,eAAe,OAAe;AACpC,QAAI,MAAM,KAAK,UAAQ,KAAK,SAAS,aAAa,CAAC,GAAG;AACpD,WAAK,OAAO,SAAS,CAAC,QAAQ,CAAC;IACjC,WAAW,MAAM,KAAK,UAAQ,KAAK,SAAS,cAAc,CAAC,GAAG;AAC5D,WAAK,OAAO,SAAS,CAAC,eAAe,CAAC;IACxC,WAAW,MAAM,KAAK,UAAQ,KAAK,SAAS,SAAS,CAAC,GAAG;AACvD,WAAK,OAAO,SAAS,CAAC,UAAU,CAAC;IACnC,OAAO;AACL,WAAK,OAAM;IACb;EACF;;EAIA,SAAM;AACJ,iBAAa,WAAW,OAAO;AAC/B,SAAK,OAAO,SAAS,CAAC,GAAG,CAAC;EAC5B;;qCA5FW,cAAW,mBAAA,UAAA,GAAA,mBAAA,MAAA,CAAA;EAAA;4EAAX,cAAW,SAAX,aAAW,WAAA,YAFV,OAAM,CAAA;;;sEAEP,aAAW,CAAA;UAHvB;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
